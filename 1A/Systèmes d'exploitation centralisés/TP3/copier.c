#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <sys/wait.h>
#include <string.h>
#include <fcntl.h>

#define MAXBUF 32

int main(int argc, char *argv[]) {

    int fdSource, fdDestination;

    /* Initialiser le buffer */
    char buf[MAXBUF];
    bzero(buf, sizeof(buf));

    /* Ouvrir les fichiers */
    fdSource = open(argv[1],O_RDONLY, S_IRUSR | S_IWUSR);
    fdDestination = open(argv[2], O_WRONLY | O_CREAT | O_TRUNC, S_IRUSR | S_IWUSR);

    /* Vérifier l'ouverture des fichiers */
    if (fdSource < 0) {
        perror("Erreur lors de l'ouverture du fichier source ");
        exit(EXIT_FAILURE);
    }
    
    if (fdDestination < 0) {
        perror("Erreur lors de l'ouverture du fichier destination ");
        exit(EXIT_FAILURE);
    }
    
    int r;
    /* Copier le contenu du fichier source vers le fichier destination */
    do {
        r = read(fdSource, buf, MAXBUF);
        if (r == -1) {
            perror("Erreur lors de la lecture du fichier source");
            exit(EXIT_FAILURE);
        }
        int w = write(fdDestination, buf, r);
        if (w == -1) {
            perror("Erreur lors de l'écriture dans le fichier destination");
            exit(EXIT_FAILURE);
        }
    } while (r > 0);

    /* Fermer les fichiers */
    close(fdSource);
    close(fdDestination);

    /* Sortie du programme */
    return EXIT_SUCCESS;
}
