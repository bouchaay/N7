/* Author : Ayoub Bouchama 
 * Groupe : F
 * TP2
 */

# include <stdio.h>
# include <unistd.h>
# include <stdlib.h>
# include <signal.h>

/* Le traitant des signaux */
void handler(int sig) {
    printf("Reception %d\n", sig);
}

int main(int argc, char *argv[]) {
    
    /* type de masque de signaux */
    sigset_t ens_sigusr1;
    sigset_t ens_sigint;

    /* initialiser à vide l'ensemble des signaux */
    sigemptyset(&ens_sigusr1);
    sigemptyset(&ens_sigint);

    /* ajouter SIGUSR1 et SIGINT à l'ensemble des signaux */
    sigaddset(&ens_sigusr1, SIGUSR1);
    sigaddset(&ens_sigint, SIGINT);

     /* traitement des signaux */
    signal(SIGUSR1, handler) ;
    signal(SIGUSR2, handler) ;

    /* masquer SIGUSR1 et SIGINT */
    sigprocmask(SIG_BLOCK, &ens_sigusr1, NULL);
    sigprocmask(SIG_BLOCK, &ens_sigint, NULL);

    /* attendre 10 secondes */
    sleep(10);

    /* Envoie de SIGUSR1 2 fois */
    kill(getpid(), SIGUSR1);
    kill(getpid(), SIGUSR1);
    
    /* attendre 3 secondes */
    sleep(3);

    /* Envoie de SIGUSR2 2 fois */
    kill(getpid(), SIGUSR2);
    kill(getpid(), SIGUSR2);

    /* Démasquer SIGUSR1 */
    sigprocmask(SIG_UNBLOCK, &ens_sigusr1, NULL);

    /* Attendre 10 secondes */
    sleep(10);

    /* Démasquer SIGINT */
    sigprocmask(SIG_UNBLOCK, &ens_sigint, NULL);

    /* Message de fin */
    printf("Salut !\n");
    
    return EXIT_SUCCESS;
}
